<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QR chuyển khoản</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body style="font-family:sans-serif; text-align:center; padding:40px;">
  <h2>Mã QR chuyển khoản</h2>
  <canvas id="qrCanvas"></canvas>
  <p id="note" style="color: grey; font-size: 14px;"></p>

  <script>
    // Đảm bảo chỉ chạy khi QRCode đã được load
    window.addEventListener('load', function () {
      const params = new URLSearchParams(window.location.search);
      const stk = params.get('stk');
      const bank = params.get('bank');
      const amount = params.get('amount');

      if (!stk || !bank || !amount) {
        document.getElementById('note').innerText = 'Thiếu tham số: stk, bank hoặc amount';
        return;
      }

      let emv = '000201010212';
      emv += '38590010A00000072701' + bank + stk;
      emv += '0208QRIBFTTA';
      emv += '5303704';
      emv += '54' + (amount.length < 10 ? '0' + amount.length : amount.length) + amount;
      emv += '5802VN';
      emv += '6304FFFF';

      QRCode.toCanvas(document.getElementById('qrCanvas'), emv, { width: 300 }, err => {
        if (err) {
          document.getElementById('note').innerText = 'Lỗi tạo mã QR';
          console.error(err);
        } else {
          document.getElementById('note').innerText = `STK: ${stk} | Bank: ${bank} | Số tiền: ${amount}`;
        }
      });
    });
  </script>
</body>
</html>
